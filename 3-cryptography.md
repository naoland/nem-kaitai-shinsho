# 3. 暗号化

![](https://s3-ap-northeast-1.amazonaws.com/nem-social/blog/0/7000/7800/7863/1543214126%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202018-11-26%2015.33.27.png)

Technical Referenceもこのあたりから、専門性が高くなってきて、訳してもさっぱりです。なので、まずは暗号化の概略まで解説してみます。

まず、Twisted Edwards曲線と呼ばれる式ですが、グラフを描いてみるとこんな風になります。

![](https://s3-ap-northeast-1.amazonaws.com/nem-social/blog/0/7000/7800/7863/1543220563%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202018-11-26%2015.32.20.png)

ほぼy = +/-1ですね。このグラフからは何も分からないので、[PythonのEd25519実装](https://www.pebblewind.com/entry/2017/10/06/204508)の解説を見てみましょう。

実は、この式が意味するのは、我々が中学や高校で習う「グラフ」が書ける式ではないのです。では、何かといういうと素数である


> q = 57896044618658097711785492504343953926634992332820282019728792003956564819949

を使って作る整数解（x, y）の「塊」です。この式はこの素数qで割った余りの整数のみで表現することになっているため、有限個の（x, y）つまり「座標」が定まるらしいです。それらの点同士ではちゃんと四則演算可能なところが楕円関数の不思議な性質。


ちなみに分数になっている-121665/121666の部分は


> 37095705934669439343138083508754565189542113879843219016388785533085940283555


で置き換えることができます。暗号世界ではこんなマイナス符号のついた割り算も正の整数になっちゃうのですね（詳細は[やってみようさんの記事](https://nemlog.nem.social/blog/20168)がおすすめです）。分数表記したのは、長ったらしい整数表記を簡単に見せるためらしい。

つまり、上の式は


（式１）


と書けて、xもyもqより小さい正の整数ということになります。計算は、普通の計算ではなく剰余計算という特殊なものであるため、グラフにはうまく描けませんが、その点の総数は、


> L = 2^252 - 27742317777372353535851937790883648493 = 7237005577332262213973186563042994240857116359379907606001950938285454250989

の８倍もあるそうです。ちなみにLも巨大素数です。

そして楕円関数を使った点(x, y)の集合の中で、四則演算ができると書きましたが、実は点と点の足し算や、整数倍（足し算の繰り返し）がとても重要です。点Xと点Xを足すと、点Zになって、点Xと点Zを足すと、点Xの３倍になるという感じです。興味のある方は調べてみると面白いかもです。だからまず、ある基準点Bをまず決めてやります。

点B(Bx, By）は、


> Bx = 15112221349535400772501151409588531511454012693041857206046113283949847762202

> By = 46316835694926478169428394003475163141307993866256225615783033603165251855960

です。qという巨大な素数の範囲内にほぼ無限の座標が飛び回っている宇宙みたいなイメージです。すべての点は式１を満たします。なんでこんなに大きな整数の座標が使われているのかというと、これをL倍するとなんと(0, 1）という座標に戻ってくるのです。はるか遠くイスカンダルから地球に戻ってくるヤマトみたいな座標ですね。宇宙全体の８分の１サイズの旅を終えると、かならずこのわかりやすい点に戻ってきてくれるので、地球は救われる的な。

----

**次回は、この暗号のしくみを使って秘密鍵から公開鍵を作るコードを紹介する予定です。**

