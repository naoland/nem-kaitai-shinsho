
メモリ4GBのマシンでNISのメインネット動かそうとしたのですが落ちてしまいました。ブロックチェーンのデータベースをメモリにモリモリ読み込んでいくので、そろそろ4GBでは辛くなっているのだと思います。スケーラビリティー問題の１つかな？


では今日もブロックチェーンのお勉強始めます。僕が補足で入れたコメントは太字になります。

# 5.1 ブロック難度


新規に作られるブロックの難度（difficulty）はそれ以前の６０ブロックの難度と時刻から計算されます。

もし６０ブロックより少ない場合は、１からそのブロックまでで計算します。

もしブロックが１個しかない場合（ネメシスブロックの場合）は、難度＝1014とします。

それ以外の場合は、下記のようにして難度を求めることとします。

![](https://s3-ap-northeast-1.amazonaws.com/nem-social/blog/0/9000/9100/9173/1545180693%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202018-12-19%209.51.13.png)

**dは過去６０ブロック難度の平均値。  
tは過去６０ブロックを作るのにかかった１ブロックあたりの平均時間（秒）
難度（difficulty）は、過去６０ブロックの難度に時間補正をかけたもの。  
tが60秒未満なら難度が上がり、60秒より多ければ難度が下がる。**

もし、上の式で計算された難度が、直前の難度よりも5%以上大きい、または小さい場合は5%の変化を上限とします。

さらに、難度そのものにも制限を設けてあります。

難度の上限値は1015であり、下限値は1013です。
 

シミュレーションとNEMベータテストにより、ブロック生成アルゴリズムは60±0.5秒の間に収まることが示されました。

もし仮に、50%（0.5）を大きく下回るインポータンスしか持たない攻撃者が、秘密裏にブロックを進めていた場合は、１ブロックでの難度の変化量が5%以内に制限されているために、攻撃者のチェーンの、特に最初の段階での生成時間が６０秒を大きく上回ることになるでしょう。

**ここでインポータンスが効いてくるわけですね。しかし、攻撃者のくだりがちょっと分かりにくかったので、この後のブロック生成のところでこの問題について改めて見直してみることにします。**

